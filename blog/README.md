# AWS Amplify Hackathon

## Day 1

In the first day we get the App up and running. Deployed to GitHub, using workflows to manage a production and development branch. We deploy our app to AWS using the `amplify` command line utility. No web development was completed today, but we see our template react application has been deployed to the URL [here](https://main.d3rwfn08hdk6tn.amplifyapp.com).

Below we outline the important steps required to get started for the AWS Amplify Hackathon.

## React

Created a React application using the `create-react-app` command line utility.

```bash
npx create-react-app my-app
```

- Install react with [tutorial](https://create-react-app.dev/)

## Amplify

Install the AWS Amplify client on my Linux machine.

```bash
npm install -g @aws-amplify/cli
```

```bash
amplify init
```

- Install Amplify with [tutorial](https://docs.amplify.aws/cli/start/install)

## GitHub

- `dev` development branch to store our source code on

```bash
# Create the development branch
git branch dev

# Set this as our default branch for pushing code to
git push --set-upstream origin dev
```

- `main` production branch for the web-packed build
- `deploy.yml` GitHub workflow to deploy our development branch to production

## Deployed

Here is the Github workflow we have created to deploy our development branch `dev` into a `production` branch `main`:

```yml
name: Deploy
on:
  push:
    branches:
      - dev
    paths:
      - src/*
      - public/*
      - package.json
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Install and Build üîß
        run: |
          npm install
          npm run-script build
        env:
          CI: false
      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@releases/v4
        with:
          BRANCH: main
          FOLDER: build
          CLEAN: true
          CLEAN_EXCLUDE: CNAME
```

We only run this script if changes are made to the react application itself. This includes changes to the `src`, `public` and `package.json` directories and files. Changes to our README or updates to the blog, do not need to trigger the deployment workflow, or be redeployed by AWS. We specify this by providing which file `paths` while trigger the `deploy.yml` workflow above.

- linked AWS to my GITHUB repository
- it is deployed to the static site generated by the main branch
- should only trigger build if `src`,`public` or `package.json` directories and files change
- deploy our production to master using `JamesIves/github-pages-deploy-action@releases/v4`

## Code Quality Analysis

This is the default GitHub Action provided under the Security tab. It runs each time we push a commit. Also it runs on a CRON schedule at 21:38 on Tuesday (each week). Without changes to the repository, we are assured these security static analysis are run weekly.

```yml
name: "CodeQL"

on:
  push:
    branches: [dev]
  pull_request:
    branches: [dev]
  schedule:
    - cron: "38 21 * * 2"

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        language: ["javascript"]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v1
        with:
          languages: ${{ matrix.language }}
      - name: Autobuild
        uses: github/codeql-action/autobuild@v1
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v1
```

## Linting

We need to add linting to the project. Linting ensures each file is structured following the same style guide. This makes the code-base maintainable.

```bash
npm i --save-dev babel-eslint eslint-config-react-app eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks
```

We add the `lint` script to our `package.json`:

```json
"scripts": {
  ...
  "lint": "node_modules/.bin/eslint --ext js src"
},
```

A workflow `lint.yml` to make sure that all code is linted correctly.

```yml
name: "Lint"

on:
  push:
    branches:
      - dev
    paths:
      - src/*
jobs:
  run-linters:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v2
      - name: Install üîß
        run: npm ci
      - name: Run Linters üî•
        run: npm run lint
```

## Day 2

We have made two changes to the workflow files.

```yml
on:
  push:
    branches: [ dev ]
    paths:
      - src/**
      - public/**
      - package.json
```

We use `/**` as opposed to `/*` to perform a recursive search for file changes to these directories. Before we were just checking at the parent level.

Secondly, we supply some additional paths. The `public` and `package.json`. If there were changes to these files and directories the production build would change. So we want to perform all the workflows that we need for changes to the production branch.
